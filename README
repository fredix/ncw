ncw is the nodecast worker

INSTALL
=======

install some debs :
apt-get install g++ make autoconf scons libboost-all-dev libqt4-dev libavahi-compat-libdnssd-dev

get submodule libraries :
git submodule update --init


make the zeromq lib :
cd externals/zeromq
./configure
make
sudo make install

install libqxt or your distribution's package libqxt-dev (>= 0.6.2)
cd external/libqxt
./configure
make
sudo make install
sudo echo "/usr/local/Qxt/lib/" >> /etc/ld.so.conf.d/x86_64-linux-gnu.conf
sudo ldconfig

make the mongodb client :
cd externals/mongodb
scons mongoclient
sudo cp libmongoclient.a /usr/local/lib
sudo ldconfig

last, make the nodecast worker :
qmake
make
mkdir ~/bin
cp ncw ~/bin


API
--------

MONGODB
create user collection
doc = { login : 'user', email : 'user@email.com', authentication_token : 'token'}
db.users.insert(doc);

1. create a node
curl -H "X-nodename: your-node" --user "user@email.com:token" http://127.0.0.1:4567/node/create
return node auth : {"node_password":"e6cc13a3-1236-46cb-b40f-a66650ab5eef","node_uuid":"2d0a7780-e8fe-4e0a-89c6-a5a2737b095a"}


2. create a workflow
curl -H "X-workflow: test" -d '{ "ls": 1, "rm": 2 }' --user "user@email.com:token" http://127.0.0.1:4567/workflow/create
return a workflow : {"uuid":"0ebcdab6-0263-42d3-be7d-9602fa15f68c"}

3. push data
## PUSH TO ONE WORKER
curl -H "X-node-uuid: 76e11acd-206e-4eef-9aa3-7e39b931cbfc" -H "X-node-password: 75d123bd-c912-43fc-acfe-dcb7642a9921" -H "X-payload-filename: myfilename" -H "X-payload-type: mydata" -X POST --data-binary @myfilename http://127.0.0.1:4567/payload/push/7faf07e7-51b6-4468-b666-57fd622ed4cd

## PUBLISH TO ALL SAME WORKER TYPE
curl -H "X-node-uuid: 76e11acd-206e-4eef-9aa3-7e39b931cbfc" -H "X-node-password: 75d123bd-c912-43fc-acfe-dcb7642a9921" -H "X-payload-filename: myfilename" -H "X-payload-type: mydata" -X POST --data-binary @myfilename http://127.0.0.1:4567/payload/publish/7faf07e7-51b6-4468-b666-57fd622ed4cd

return a session uuid : {"uuid":"7b32b9d0-3ea9-4663-9577-4b34192055bf"}


../bin/mongodb/bin/mongofiles -d yourbase list


USE
===

create a node :

curl -H "X-nodename: your-node-name" --user "email:token" http://ncs-ip:4567/node/create
return node auth : {"node_password":"e6cc13a3-1236-46cb-b40f-a66650ab5eef","node_uuid":"2d0a7780-e8fe-4e0a-89c6-a5a2737b095a"}


Launch a worker :
ncw --ncs-ip=127.0.0.1 --ncs-port=5569 --node-uuid=your-node-uuid --node-password=your-node-password --worker-type=process --worker-name="ls" --exec="ls" --stdout=true --directory=/home/user/ncw_data/


Launch a service :
ncw --ncs-ip=127.0.0.1 --ncs-port=5569 --node-uuid=your-node-uuid --node-password=your-node-password --worker-type=service --worker-name="bttrack" --exec="/usr/bin/bttrack --bind 0.0.0.0 --port 6969 --dfile dstate" --stdout=true --directory=/home/user/ncw_data/



contact : fredix at nodecast dot net
